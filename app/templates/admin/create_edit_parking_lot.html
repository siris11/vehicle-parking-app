{% extends "base.html" %}
{% from "bootstrap5/form.html" import render_form %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ legend }}</h1>
</div>

<div class="row">
    <div class="col-md-8 col-lg-6">
        {# Determine action URL based on whether it's a create or edit form #}
        {% set action_url = url_for('admin_routes.create_parking_lot') %}
        {% if form.name.data and lot %}
            {% set action_url = url_for('admin_routes.edit_parking_lot', lot_id=lot.id) %}
        {% endif %}
        
        {{ render_form(form, action=action_url, method='post', novalidate=True) }}
        
        <div class="mt-3">
            <a href="{{ url_for('admin_routes.list_parking_lots') }}" class="btn btn-outline-secondary">Cancel</a>
        </div>
    </div>
</div>

{% if lot and lot.spots.count() > 0 %}
    <hr class="my-4">
    <h3 class="h4">Current Spots in {{lot.name }} ({{ lot.spots.count() }})</h3>
    <p class="text-muted">
        Editing spot details individually is not done here. Capacity changes will add/remove available spots automatically.
        To reduce capacity, ensure enough spots are marked 'Available'.
    </p>
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-2 mb-3">
        {% for spot in lot.spots.order_by(ParkingSpot.spot_number).all() %}
            <div class="col">
                <div class="card h-100 text-center {{ 'bg-danger text-white' if spot.status == 'O' else 'bg-light' }}">
                    <div class="card-body p-2">
                        <h6 class="card-title mb-0">{{ spot.spot_number }}</h6>
                        <small class="text-muted {{ 'text-white-50' if spot.status == 'O' else '' }}">
                            {{ 'Occupied' if spot.status == 'O' else 'Available' }}
                        </small>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

{% endblock %} 